(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{111:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),a=n(21),s=n.n(a),i=(n(74),n(7));function o(e,t){var n="gapshap-app-"+e,r=Object(c.useState)((function(){var e=localStorage.getItem(n);return null!=e?JSON.parse(e):"function"===typeof t?t():t})),a=Object(i.a)(r,2),s=a[0],o=a[1];return Object(c.useEffect)((function(){localStorage.setItem(n,JSON.stringify(s))}),[n,s]),[s,o]}var l=n(114),j=n(118),d=n(115),u=n(120),b=n(1);function O(e){var t=e.onIdSubmit,n=Object(c.useRef)();return Object(b.jsx)(l.a,{className:"align-items-center d-flex",style:{height:"100vh"},children:Object(b.jsxs)(j.a,{onSubmit:function(e){e.preventDefault(),t(n.current.value)},className:"w-100",children:[Object(b.jsxs)(j.a.Group,{children:[Object(b.jsx)(j.a.Label,{children:"Enter Your Id"}),Object(b.jsx)(j.a.Control,{type:"text",ref:n,required:!0})]}),Object(b.jsxs)("div",{className:"mt-2",children:[Object(b.jsx)(d.a,{type:"submit",className:"me-2",children:"Login"}),Object(b.jsx)(d.a,{onClick:function(){t(Object(u.a)())},variant:"secondary",children:"Create A New Id"})]})]})})}var x=n(121),h=n(119),f=n(117),m=n(122),v=n(24),p=n(22),g=r.a.createContext();function C(){return Object(c.useContext)(g)}function y(e){var t=e.children,n=o("contacts",[]),c=Object(i.a)(n,2),r=c[0],a=c[1];return Object(b.jsx)(g.Provider,{value:{contacts:r,createContact:function(e,t){a((function(n){return[].concat(Object(p.a)(n),[{id:e,name:t}])}))}},children:t})}var N=n(68),w=n.n(N),S=r.a.createContext();function I(e){var t=e.id,n=e.children,r=Object(c.useState)(),a=Object(i.a)(r,2),s=a[0],o=a[1];return Object(c.useEffect)((function(){var e=w()("http://localhost:5000",{query:{id:t},transports:["websocket"]});return o(e),function(){return e.close()}}),[t]),Object(b.jsx)(S.Provider,{value:s,children:n})}var k=r.a.createContext();function M(){return Object(c.useContext)(k)}function B(e){var t=e.id,n=e.children,r=o("conversations",[]),a=Object(i.a)(r,2),s=a[0],l=a[1],j=Object(c.useState)(0),d=Object(i.a)(j,2),u=d[0],O=d[1],x=C().contacts,h=Object(c.useContext)(S);var f=Object(c.useCallback)((function(e){var t=e.recipients,n=e.text,c=e.sender;l((function(e){var r=!1,a={sender:c,text:n},s=e.map((function(e){return n=e.recipients,c=t,n.length===c.length&&(n.sort(),c.sort(),n.every((function(e,t){return e===c[t]})))?(r=!0,Object(v.a)(Object(v.a)({},e),{},{messages:[].concat(Object(p.a)(e.messages),[a])})):e;var n,c}));return r?s:[].concat(Object(p.a)(e),[{recipients:t,messages:[a]}])}))}),[l]);Object(c.useEffect)((function(){if(null!=h)return h.on("receive-message",f),function(){return h.off("receive-message")}}),[h,f]);var m=s.map((function(e,n){var c=e.recipients.map((function(e){var t=x.find((function(t){return t.id===e})),n=t&&t.name||e;return{id:e,name:n}})),r=e.messages.map((function(e){var n=x.find((function(t){return t.id===e.sender})),c=n&&n.name||e.sender,r=t===e.sender;return Object(v.a)(Object(v.a)({},e),{},{senderName:c,fromMe:r})})),a=n===u;return Object(v.a)(Object(v.a)({},e),{},{messages:r,recipients:c,selected:a})})),g={conversations:m,selectedConversation:m[u],sendMessage:function(e,n){h.emit("send-message",{recipients:e,text:n}),f({recipients:e,text:n,sender:t})},selectConversationIndex:O,createConversation:function(e){l((function(t){return[].concat(Object(p.a)(t),[{recipients:e,messages:[]}])}))}};return Object(b.jsx)(k.Provider,{value:g,children:n})}function H(){var e=M(),t=e.conversations,n=e.selectConversationIndex;return Object(b.jsx)(m.a,{variant:"flush",children:t.map((function(e,t){return Object(b.jsx)(m.a.Item,{action:!0,onClick:function(){return n(t)},active:e.selected,children:e.recipients.map((function(e){return e.name})).join(", ")},t)}))})}function L(){var e=C().contacts;return Object(b.jsx)(m.a,{variant:"flush",children:e.map((function(e){return Object(b.jsx)(m.a.Item,{className:"bg-light",children:e.name},e.id)}))})}function P(e){var t=e.closeModal,n=Object(c.useRef)(),a=Object(c.useRef)(),s=C().createContact;return Object(b.jsxs)(r.a.Fragment,{children:[Object(b.jsx)(f.a.Header,{closeButton:!0,children:"Create Contact"}),Object(b.jsx)(f.a.Body,{children:Object(b.jsxs)(j.a,{onSubmit:function(e){e.preventDefault(),s(n.current.value,a.current.value),t()},children:[Object(b.jsxs)(j.a.Group,{children:[Object(b.jsx)(j.a.Label,{children:"Id"}),Object(b.jsx)(j.a.Control,{type:"text",ref:n,required:!0})]}),Object(b.jsxs)(j.a.Group,{children:[Object(b.jsx)(j.a.Label,{children:"Name"}),Object(b.jsx)(j.a.Control,{type:"text",ref:a,required:!0})]}),Object(b.jsx)(d.a,{type:"submit",className:"mt-2",children:"Create"})]})})]})}function Y(e){var t=e.closeModal,n=Object(c.useState)([]),a=Object(i.a)(n,2),s=a[0],o=a[1],l=C().contacts,u=M().createConversation;return Object(b.jsxs)(r.a.Fragment,{children:[Object(b.jsx)(f.a.Header,{closeButton:!0,children:"Create Conversation"}),Object(b.jsx)(f.a.Body,{children:Object(b.jsxs)(j.a,{onSubmit:function(e){e.preventDefault(),console.log(s),s.length<=0?window.alert("Please add contacts to the chat"):u(s),t()},children:[l.map((function(e){return Object(b.jsx)(j.a.Group,{controlId:e.id,children:Object(b.jsx)(j.a.Check,{type:"checkbox",value:s.includes(e.id),label:e.name,onChange:function(){return t=e.id,void o((function(e){return e.includes(t)?e.filter((function(e){return t!==e})):[].concat(Object(p.a)(e),[t])}));var t}})},e.id)})),Object(b.jsx)(d.a,{type:"submit",children:"Create"})]})})]})}var q="conversations",D="contacts";function E(e){var t=e.id,n=Object(c.useState)(q),r=Object(i.a)(n,2),a=r[0],s=r[1],o=Object(c.useState)(!1),l=Object(i.a)(o,2),j=l[0],u=l[1],O=a===q;function m(){u(!1)}return Object(b.jsxs)("div",{style:{width:"25%"},className:"d-flex flex-column",children:[Object(b.jsxs)(x.a.Container,{activeKey:a,onSelect:s,children:[Object(b.jsxs)(h.a,{variant:"pills",className:"justify-content-center",children:[Object(b.jsx)(h.a.Item,{children:Object(b.jsx)(h.a.Link,{eventKey:q,children:"Conversations"})}),Object(b.jsx)(h.a.Item,{children:Object(b.jsx)(h.a.Link,{eventKey:D,children:"Contacts"})})]}),Object(b.jsxs)(x.a.Content,{className:"border-end overflow-auto flex-grow-1 mt-3",children:[Object(b.jsx)(x.a.Pane,{eventKey:q,children:Object(b.jsx)(H,{})}),Object(b.jsx)(x.a.Pane,{eventKey:D,children:Object(b.jsx)(L,{})})]}),Object(b.jsxs)("div",{className:"p-2 border-top border-end small",children:[Object(b.jsx)("strong",{children:"Your Id: "}),Object(b.jsx)("span",{className:"text-muted",children:t})]}),Object(b.jsxs)(d.a,{onClick:function(){return u(!0)},className:"rounded-0 btn-new",children:["New ",O?"Conversation":"Contact"]})]}),Object(b.jsx)(f.a,{show:j,onHide:m,children:O?Object(b.jsx)(Y,{closeModal:m}):Object(b.jsx)(P,{closeModal:m})})]})}var F=n(116);function G(){var e=Object(c.useState)(""),t=Object(i.a)(e,2),n=t[0],r=t[1],a=Object(c.useCallback)((function(e){e&&e.scrollIntoView({smooth:!0})}),[]),s=M(),o=s.sendMessage,l=s.selectedConversation;return Object(b.jsxs)("div",{className:"d-flex flex-column flex-grow-1",children:[Object(b.jsx)("div",{className:"flex-grow-1 overflow-auto",children:Object(b.jsx)("div",{className:"d-flex flex-column align-items-start justify-content-end px-3",children:l.messages.map((function(e,t){var n=l.messages.length-1===t;return Object(b.jsxs)("div",{ref:n?a:null,className:"my-2 d-flex flex-column ".concat(e.fromMe?"align-self-end align-items-end":"align-items-start"),children:[Object(b.jsx)("div",{className:"bg-new rounded px-3 py-2 ".concat(e.fromMe?" text-white":"border"),children:e.text}),Object(b.jsx)("div",{className:"text-muted small ".concat(e.fromMe?"text-right":""),children:e.fromMe?"You":e.senderName})]},t)}))})}),Object(b.jsx)(j.a,{onSubmit:function(e){e.preventDefault(),o(l.recipients.map((function(e){return e.id})),n),r("")},children:Object(b.jsx)(j.a.Group,{className:"m-2",children:Object(b.jsxs)(F.a,{children:[Object(b.jsx)(j.a.Control,{as:"textarea",required:!0,value:n,onChange:function(e){return r(e.target.value)},style:{height:"75px",resize:"none"},className:"bg-light text-dark"}),Object(b.jsx)(F.a.Append,{children:Object(b.jsx)(d.a,{type:"submit",className:"ms-2 send",children:"Send"})})]})})})]})}function K(e){var t=e.id,n=M().selectedConversation;return Object(b.jsxs)("div",{className:"d-flex",style:{height:"100vh"},children:[Object(b.jsx)(E,{id:t}),n&&Object(b.jsx)(G,{})]})}function J(e){e.closeModal;return Object(b.jsx)("div",{children:Object(b.jsxs)(r.a.Fragment,{children:[Object(b.jsx)(f.a.Header,{closeButton:!0,children:"How To Use application"}),Object(b.jsx)(f.a.Body,{children:Object(b.jsxs)("ul",{children:[Object(b.jsx)("li",{children:"First Add new Contacts."}),Object(b.jsx)("li",{children:"Then You can start a new conversation with the new users."}),Object(b.jsx)("li",{children:"You can chat individually or in group as you like."}),Object(b.jsxs)("li",{children:["Your ",Object(b.jsx)("strong",{children:"ID"})," is the ",Object(b.jsx)("i",{children:"key"})," for the conversation."]})]})})]})})}var A=function(){var e=o("id"),t=Object(i.a)(e,2),n=t[0],c=t[1],a=r.a.useState(!1),s=Object(i.a)(a,2),l=s[0],j=s[1],u=Object(b.jsx)(I,{id:n,children:Object(b.jsx)(y,{children:Object(b.jsx)(B,{id:n,children:Object(b.jsx)(K,{id:n})})})});function x(){j(!1)}return Object(b.jsxs)(b.Fragment,{children:[n?u:Object(b.jsx)(O,{onIdSubmit:c}),Object(b.jsxs)("div",{className:"info",children:[Object(b.jsx)(d.a,{onClick:function(){return j(!0)},variant:"warning",className:"text-white",children:"Info"}),Object(b.jsx)(f.a,{show:l,onHide:x,children:Object(b.jsx)(J,{closeModal:x})})]})]})};n(110);s.a.render(Object(b.jsx)(A,{}),document.getElementById("root"))},74:function(e,t,n){}},[[111,1,2]]]);
//# sourceMappingURL=main.9c330d1d.chunk.js.map